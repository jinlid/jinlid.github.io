<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="第六章--监控命令, jinlid&#39;s blog">
    <meta name="description" content="[TOC]
本章介绍Linux环境下系统资源监控的核心命令，重点讲解sar、uptime、mpstat、iostat、ipcs五大高频命令的应用。这些命令分别针对CPU、磁盘I/O、共享内存等关键系统资源，实现快速巡检、性能统计与瓶颈定位，">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>第六章--监控命令 | jinlid&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">jinlid&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">jinlid&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/12.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">第六章--监控命令</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7/">
                                <span class="chip bg-color">性能调优工具</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/linux/" class="post-category">
                                linux
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2026-01-28
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>[TOC]</p>
<p>本章介绍Linux环境下系统资源监控的核心命令，重点讲解sar、uptime、mpstat、iostat、ipcs五大高频命令的应用。这些命令分别针对CPU、磁盘I/O、共享内存等关键系统资源，实现快速巡检、性能统计与瓶颈定位，覆盖日常运维及故障排查核心场景，可直接应用于生产环境，助力保障服务器稳定高效运行。</p>
<span id="more"></span>

<h2 id="6-1-sar-命令"><a href="#6-1-sar-命令" class="headerlink" title="6.1 sar 命令"></a>6.1 sar 命令</h2><h3 id="6-1-1-sar-工具简介"><a href="#6-1-1-sar-工具简介" class="headerlink" title="6.1.1 sar 工具简介"></a>6.1.1 sar 工具简介</h3><p>System Activity Reporter（sar）是一款功能强大的系统性能分析工具，隶属于 Sysstat 系统资源工具包，是Linux系统管理员必备的系统监控工具之一。它能够全面采集并分析系统各类性能数据，包括 CPU 活动、内存与分页、中断、设备负载、网络状态、进程线程分配及交换空间使用等，所有数据均来源于 /proc 文件系统。</p>
<p>默认情况下，sar 每小时的固定节点会自动采集一次系统数据，用于后续的历史性能分析与问题排查。本教程将详细讲解 sar 工具在 Linux 系统中的安装、配置方法，并结合常用命令示例，帮助你快速上手使用 sar 监控Linux系统。</p>
<h3 id="6-1-2-sar-常用命令速查表"><a href="#6-1-2-sar-常用命令速查表" class="headerlink" title="6.1.2 sar 常用命令速查表"></a>6.1.2 sar 常用命令速查表</h3><table>
<thead>
<tr>
<th align="center">监控对象</th>
<th align="center">sar 命令</th>
<th align="center">补充说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">监控网卡</td>
<td align="center">sar -n DEV</td>
<td align="center">查看网卡收发数据包、流量等详细信息</td>
</tr>
<tr>
<td align="center">监控 TCP</td>
<td align="center">sar -n TCP</td>
<td align="center">监控 TCP 连接状态、收发数据等指标</td>
</tr>
<tr>
<td align="center">监控 UDP</td>
<td align="center">sar -n UDP</td>
<td align="center">查看 UDP 数据包收发情况</td>
</tr>
<tr>
<td align="center">监控 SOCK</td>
<td align="center">sar -n SOCK</td>
<td align="center">监控系统 socket 连接总数及状态</td>
</tr>
<tr>
<td align="center">监控 CPU</td>
<td align="center">sar -u</td>
<td align="center">查看整体 CPU 使用率（用户态、系统态等）</td>
</tr>
<tr>
<td align="center">监控队列</td>
<td align="center">sar -q</td>
<td align="center">监控进程队列长度、系统平均负载等</td>
</tr>
<tr>
<td align="center">监控上下文切换</td>
<td align="center">sar -w</td>
<td align="center">查看系统上下文切换频率，反映 CPU 调度情况</td>
</tr>
<tr>
<td align="center">监控内存（分页相关）</td>
<td align="center">sar -B</td>
<td align="center">监控内存分页交换情况（页面换入 / 换出速率）</td>
</tr>
<tr>
<td align="center">监控内存（使用情况）</td>
<td align="center">sar -r</td>
<td align="center">查看内存空闲、已用、缓存等详细使用状态</td>
</tr>
<tr>
<td align="center">监控 SWAP（交换空间）</td>
<td align="center">sar -W</td>
<td align="center">监控交换空间的使用情况及交换速率</td>
</tr>
<tr>
<td align="center">监控磁盘（I/O 吞吐量）</td>
<td align="center">sar -b</td>
<td align="center">查看磁盘 I/O 总吞吐量、读写速率等</td>
</tr>
<tr>
<td align="center">监控磁盘（设备负载）</td>
<td align="center">sar -d</td>
<td align="center">查看单个磁盘设备的 I/O 负载、响应时间等</td>
</tr>
</tbody></table>
<h3 id="6-1-3-sar-安装与配置"><a href="#6-1-3-sar-安装与配置" class="headerlink" title="6.1.3 sar 安装与配置"></a>6.1.3 sar 安装与配置</h3><p>sar 工具并不默认包含在 Linux 系统中，需通过安装 sysstat 软件包获取。本教程以 <strong>BCLinux 21.10</strong> 系统为例，讲解具体安装与配置步骤。</p>
<p><strong>安装 sar</strong></p>
<p>BCLinux 21.10 系统默认使用 dnf 作为包管理器，打开终端，执行以下命令安装 sysstat，安装完成后即可直接使用 sar 命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">dnf <span class="token function">install</span> sysstat -y
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>启用 sar 数据采集</strong></p>
<p>安装完成后，需先启用 sar 的数据采集功能，否则无法自动收集系统历史性能数据。步骤如下：</p>
<ol>
<li>打开 sar 的核心配置文件：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">vim /etc/sysconfig/sysstat
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>找到<code>ENABLED</code>项，修改为：<code>ENABLED="true"</code>（注释则先取消），保存退出。</p>
<pre class="line-numbers language-bash"><code class="language-bash">ENABLED<span class="token operator">=</span><span class="token string">"true"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>启动 sysstat 相关服务并设置开机自启：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 启动采集+汇总定时器，直接生效</span>
systemctl <span class="token function">enable</span> --now sysstat-collect.timer sysstat-summary.timer

<span class="token comment" spellcheck="true"># 主服务开机自启</span>
systemctl <span class="token function">enable</span> sysstat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>验证采集功能是否正常运行：</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看定时器状态</span>
systemctl list-timers <span class="token operator">|</span> <span class="token function">grep</span> sysstat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>核心配置修改</strong></p>
<p>若需自定义采集频率、日志保留时间等，可修改对应文件。</p>
<pre class="line-numbers language-bash"><code class="language-bash">vim /etc/sysconfig/sysstat
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改内容如下：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 保留30天历史日志（默认7天，按需改）</span>
HISTORY<span class="token operator">=</span>30
<span class="token comment" spellcheck="true"># 超过10天的日志自动压缩</span>
COMPRESSAFTER<span class="token operator">=</span>10
<span class="token comment" spellcheck="true"># 日志保存目录（系统默认，无需改）</span>
SA_DIR<span class="token operator">=</span>/var/log/sa
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如需采集全量性能指标</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 采集CPU/内存/磁盘/网络等所有指标（默认仅磁盘）</span>
SADC_OPTIONS<span class="token operator">=</span><span class="token string">"-S XALL"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>配置修改后<strong>无需重启服务</strong>，下次采集自动生效。</p>
<p><strong>自定义采集频率</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 创建配置覆盖目录（自动生效，不修改系统默认文件）</span>
<span class="token function">mkdir</span> -p /etc/systemd/system/sysstat-collect.timer.d/
<span class="token comment" spellcheck="true"># 写入自定义频率配置</span>
<span class="token function">cat</span> <span class="token operator">></span> /etc/systemd/system/sysstat-collect.timer.d/override.conf <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
[Timer]
OnCalendar=*:0/5  # 每5分钟采集一次，改*:*则每分钟
EOF</span>
<span class="token comment" spellcheck="true"># 重载配置并重启定时器</span>
systemctl daemon-reload <span class="token operator">&amp;&amp;</span> systemctl restart sysstat-collect.timer
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>验证数据采集</strong></p>
<p>配置完成后需等待<strong>第一个采集周期</strong>（如 5/10 分钟），再验证：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看是否生成数据文件（saXX为当月日期，如sa28）</span>
<span class="token function">ls</span> -l /var/log/sa/
<span class="token comment" spellcheck="true"># 2. 查看今日采集的性能数据（直接运行，自动读取当日文件）</span>
sar
<span class="token comment" spellcheck="true"># 3. 手动触发一次采集（测试用，立即生成数据）</span>
/usr/lib64/sa/sa1 1 1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-1-5-sar-命令基础使用方法"><a href="#6-1-5-sar-命令基础使用方法" class="headerlink" title="6.1.5 sar 命令基础使用方法"></a>6.1.5 sar 命令基础使用方法</h3><p>sar 命令的使用分为<strong>实时监控</strong>（查看当前系统性能）和<strong>历史查询</strong>（查看已采集的历史数据）两种核心场景，在 BCLinux 系统中的用法与原生 Linux 一致，核心语法如下：</p>
<p><strong>核心语法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 实时监控：无-f选项，直接指定监控参数+采样间隔+采样次数</span>
sar <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>采样间隔<span class="token punctuation">]</span> <span class="token punctuation">[</span>采样次数<span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 2. 历史查询：使用-f选项指定默认的历史数据文件路径</span>
sar <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> -f /var/log/sysstat/saXX
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>参数说明</strong></p>
<ul>
<li>采样间隔：每次采集数据的时间间隔（单位：秒）。</li>
<li>采样次数：需要采集的次数；若不指定，默认采集一次（实时监控）或显示该文件的所有历史数据（历史查询）。</li>
<li>saXX：历史数据文件名，XX 对应当月日期（如 15 表示当月 15 号的历史数据），文件位于默认的<code>/var/log/sysstat/</code>目录。</li>
</ul>
<p><strong>基础示例（查看历史 CPU 数据）</strong></p>
<p>执行以下命令，查看当月 24 号的 CPU 累计使用情况（需替换 sa24 为你系统中存在的文件名）：</p>
<pre class="line-numbers language-bash"><code class="language-bash">sar -u -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>典型输出</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">Linux 4.19.90-2107.6.0.0100.oe1.bclinux.x86_64 <span class="token punctuation">(</span>hostname<span class="token punctuation">)</span>     01/28/2026      _x86_64_        <span class="token punctuation">(</span>4 CPU<span class="token punctuation">)</span>

09:00:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
09:10:01 AM     all      0.25      0.00      0.12      0.03      0.00     99.60
09:20:01 AM     all      0.23      0.00      0.11      0.02      0.00     99.64
Average:        all      0.24      0.00      0.11      0.02      0.00     99.62
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>输出字段说明</strong></p>
<ul>
<li><code>Linux 4.19.90-2107.6.0.0100.oe1.bclinux.x86_64</code>：bclinux系统的内核版本。</li>
<li><code>hostname</code>：采集数据的主机名。</li>
<li><code>01/28/2026</code>：数据采集日期。</li>
<li><code>x86_64</code>：系统架构。</li>
<li><code>(4 CPU)</code>：系统可用 CPU 核心数。</li>
<li><code>%user</code>：CPU 在用户态的使用率（运行用户应用程序的时间占比）。</li>
<li><code>%nice</code>：CPU 在 nice 优先级进程上的使用率（调整过优先级的用户进程）。</li>
<li><code>%system</code>：CPU 在内核态的使用率（运行系统内核指令的时间占比）。</li>
<li><code>%iowait</code>：CPU 等待 I/O 操作完成的时间占比（I/O 瓶颈会导致该值升高）。</li>
<li><code>%steal</code>：被虚拟化环境中其他虚拟机占用的 CPU 时间占比。</li>
<li><code>%idle</code>：CPU 空闲时间占比（该值过低表示 CPU 负载过高）。</li>
</ul>
<h3 id="6-1-6-sar-常用命令详细示例"><a href="#6-1-6-sar-常用命令详细示例" class="headerlink" title="6.1.6 sar 常用命令详细示例"></a>6.1.6 sar 常用命令详细示例</h3><p>结合前面的速查表，以下是 <strong>BCLinux</strong> 系统中各监控场景的详细使用示例，包含实时监控、历史查询及输出说明，以帮助快速排查系统性能问题。</p>
<p><strong>CPU 监控（sar -u /sar -P）</strong></p>
<p><strong>查看整体 CPU 使用率</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看当前日期已采集的CPU使用率（默认显示所有历史采样点）</span>
sar -u

<span class="token comment" spellcheck="true"># 2. 实时监控：每1秒采集一次，共采集3次，快速查看当前CPU负载</span>
sar -u 1 3

<span class="token comment" spellcheck="true"># 3. 历史查询：查看当月28号的CPU使用率</span>
sar -u -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>查看单个 / 所有 CPU 核心使用率</strong></p>
<p>当系统存在多个 CPU 核心时，可通过<code>-P</code>选项查看单个 / 所有核心的负载情况，精准定位 CPU 瓶颈：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看所有CPU核心的使用率（当前日期历史数据）</span>
sar -P ALL

<span class="token comment" spellcheck="true"># 2. 实时监控：每1秒采集一次，共3次，查看所有核心负载</span>
sar -P ALL 1 3

<span class="token comment" spellcheck="true"># 3. 查看单个核心（如核心1，核心编号从0开始）的使用率</span>
sar -P 1

<span class="token comment" spellcheck="true"># 4. 历史查询：查看当月28号所有核心的使用率</span>
sar -P ALL -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>内存监控（sar -r /sar -B）</strong></p>
<p><strong>查看内存使用详情（sar -r）</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看当前日期内存使用情况（空闲、已用、缓存等）</span>
sar -r

<span class="token comment" spellcheck="true"># 2. 实时监控：每1秒采集一次，共3次</span>
sar -r 1 3

<span class="token comment" spellcheck="true"># 3. 历史查询：查看当月28号内存使用情况</span>
sar -r -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>典型输出字段说明（单位：KB）</strong></p>
<ul>
<li>kbmemfree：系统空闲内存大小。</li>
<li>kbavail：可直接分配给应用程序的内存大小（包含空闲内存 + 可回收缓存），Linux 系统中该指标为内存剩余的核心参考。</li>
<li>kbmemused：已使用内存大小（包含缓存、缓冲区，非实际应用占用）。</li>
<li>% memused：内存使用率（需结合 kbavail 判断，避免被缓存占用误导）。</li>
<li>kbbuffers：用于内核缓冲区的内存大小（存储磁盘 I/O 临时数据）。</li>
<li>kbcached：用于页面缓存的内存大小（存储文件内容，可随时回收）。</li>
</ul>
<p><strong>查看内存分页交换（sar -B）</strong></p>
<p>用于监控内存分页（页面换入 / 换出）情况，反映 Linux 系统是否内存不足（频繁分页会导致系统卡顿、应用响应缓慢）：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 实时监控：每1秒采集一次，共3次，查看分页交换速率</span>
sar -B 1 3
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>交换空间监控（sar -W）</strong></p>
<p>交换空间（SWAP）是 Linux 系统硬盘上的一块虚拟内存区域，当物理内存不足时，系统会将部分内存数据写入 SWAP，<strong>频繁使用 SWAP 会严重降低系统性能</strong>，需重点监控：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看当前日期SWAP使用情况</span>
sar -W

<span class="token comment" spellcheck="true"># 2. 实时监控：每1秒采集一次，共3次</span>
sar -W 1 3

<span class="token comment" spellcheck="true"># 3. 历史查询：查看当月28号SWAP使用情况</span>
sar -W -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>输出字段说明</strong></p>
<ul>
<li>pswpin/s  # 每秒从交换空间换入物理内存的页面数（pages/秒） </li>
<li>pswpout/s # 每秒从物理内存换出到交换空间的页面数（pages/秒）</li>
</ul>
<p><strong>磁盘 I/O 监控（sar -b /sar -d）</strong></p>
<p>Linux 系统常用于服务器场景，磁盘 I/O 是性能瓶颈的高频点，通过 sar 可精准监控磁盘吞吐量和单设备负载。</p>
<p><strong>查看磁盘整体 I/O 吞吐量（sar -b）</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 查看当前日期磁盘I/O整体情况</span>
sar -b

<span class="token comment" spellcheck="true"># 2. 实时监控：每1秒采集一次，共3次</span>
sar -b 1 3

<span class="token comment" spellcheck="true"># 3. 历史查询：查看当月24号磁盘I/O吞吐量</span>
sar -b -f /var/log/sa/sa28
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>常用输出字段说明</strong></p>
<ul>
<li>tps：每秒磁盘 I/O 请求总数（包含读请求和写请求）。</li>
<li>rtps：每秒磁盘读请求数。</li>
<li>wtps：每秒磁盘写请求数。</li>
<li>bread/s：每秒从磁盘读取的数据量（单位：块 / 秒）。</li>
<li>bwrtn/s：每秒向磁盘写入的数据量（单位：块 / 秒）。</li>
</ul>
<p><strong>查看单个磁盘设备负载（sar -d）</strong></p>
<p>定位 Linux系统中<strong>具体哪个磁盘设备</strong>存在 I/O 瓶颈（如系统盘、数据盘），精准定位存储问题：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 实时监控：每1秒采集一次，共3次，查看所有磁盘设备的I/O负载</span>
sar -d 1 3
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>网络监控（sar -n）</strong></p>
<p>sar -n 支持多种网络监控类型，适配linux系统的服务器网络场景，结合速查表，常用示例如下（可快速排查网络丢包、流量过高问题）：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 监控网卡（DEV）：查看所有网卡收发数据包、流量、丢包率等</span>
sar -n DEV 1 3

<span class="token comment" spellcheck="true"># 2. 监控TCP连接：查看TCP连接状态（ESTABLISHED、LISTEN等）、收发包数</span>
sar -n TCP 1 3

<span class="token comment" spellcheck="true"># 3. 监控UDP：查看UDP数据包收发情况、端口使用情况</span>
sar -n UDP 1 3

<span class="token comment" spellcheck="true"># 4. 监控socket连接：查看系统socket总数及各状态连接数</span>
sar -n SOCK 1 3
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>其他常用监控</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 监控进程队列（sar -q）：查看系统平均负载、进程等待队列长度，反映系统整体繁忙程度</span>
sar -q 1 3

<span class="token comment" spellcheck="true"># 2. 监控上下文切换（sar -w）：查看CPU上下文切换频率，反映CPU调度压力（频率过高表示进程调度频繁）</span>
sar -w 1 3
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-1-7-sar命令使用建议"><a href="#6-1-7-sar命令使用建议" class="headerlink" title="6.1.7 sar命令使用建议"></a>6.1.7 sar命令使用建议</h3><p>结合 Linux的系统特性和服务器端的使用场景，给出以下针对性使用建议：</p>
<ol>
<li><strong>查看官方手册</strong>：sar 命令的选项和字段较多，可通过执行<code>man sar</code>查看完整手册，同时可通过<code>dnf info sysstat</code>查看 BCLinux系统中 sysstat 包的适配说明。</li>
<li><strong>结合历史数据排查问题</strong>：BCLinux 服务器出现性能瓶颈（如应用卡顿、服务无响应、负载过高）时，通过<code>sar -f</code>查看对应时间段的历史数据，精准定位问题根源（CPU 负载过高、磁盘 I/O 瓶颈、内存不足、网络流量异常等）。</li>
<li><strong>适配服务器采集频率</strong>：对于高负载的 BCLinux 生产服务器，可将采集频率调整为 1 分钟一次（修改<code>/etc/cron.d/sysstat</code>中的<code>*/10</code>为<code>*/1</code>），便于更精准地捕捉性能波动；对于低负载服务器，保持默认 10 分钟采集即可，减少系统资源消耗。</li>
<li><strong>开启全量采集数据</strong>：若 BCLinux  系统用于核心业务监控，将<code>/etc/sysstat/sysstat</code>中的<code>SADC_OPTIONS</code>改为<code>SADC_OPTIONS="-S XALL"</code>，采集 CPU、内存、磁盘、网络、进程、中断等全量指标，为问题排查提供完整数据支撑。</li>
<li><strong>日志目录权限</strong>：BCLinux 系统中<code>/var/log/sysstat/</code>目录默认归 root 用户所有，普通用户查看历史数据需加<code>sudo</code>，若需开放权限，可通过<code>chmod</code>调整目录权限（不建议生产环境操作）。</li>
</ol>
<h2 id="6-2-uptime监控CPU负载"><a href="#6-2-uptime监控CPU负载" class="headerlink" title="6.2 uptime监控CPU负载"></a>6.2 uptime监控CPU负载</h2><p>在系统性能监控中，了解CPU的负载情况至关重要。<code>uptime</code> 命令是一个简洁有效的工具，可以帮助我们获取系统的负载平均值。通过分析这些负载值，我们可以判断系统在不同时间段内的工作状态，从而做出相应的调整和优化。</p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a><strong>环境准备</strong></h3><p>本教程适用于各种 Unix/Linux 系统，确保您有权限访问终端并运行命令。</p>
<hr>
<h3 id="CPU-负载监控"><a href="#CPU-负载监控" class="headerlink" title="CPU 负载监控"></a><strong>CPU 负载监控</strong></h3><h4 id="使用-uptime-监控-CPU-负载"><a href="#使用-uptime-监控-CPU-负载" class="headerlink" title="使用 uptime 监控 CPU 负载"></a><strong>使用 uptime 监控 CPU 负载</strong></h4><p><strong>操作步骤：</strong></p>
<ol>
<li><p><strong>打开终端</strong>：在您的服务器或工作站上打开一个终端窗口。</p>
</li>
<li><p><strong>执行 uptime 命令</strong>：</p>
<p>在终端中输入以下命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">bashuptime
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>您将看到类似于以下的输出：</p>
<pre class="line-numbers language-bash"><code class="language-bash">14:29:38 up  3:16,  1 user,  load average: 20.29, 19.10, 18.50
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<h3 id="输出指标解读"><a href="#输出指标解读" class="headerlink" title="输出指标解读"></a><strong>输出指标解读</strong></h3><p>在上面的输出中，重点关注最后三个数字，它们代表了系统负载在过去1分钟、5分钟和15分钟内的平均值。这些值分别为：</p>
<ul>
<li><strong>1分钟平均负载</strong>：20.29</li>
<li><strong>5分钟平均负载</strong>：19.10</li>
<li><strong>15分钟平均负载</strong>：18.50</li>
</ul>
<p><strong>负载平均值的含义</strong></p>
<ul>
<li><strong>负载的概念</strong>：负载平均值并不是简单的数学均值，而是基于指数衰减的累加值。它表示在特定时间段内，系统中处于可运行状态和不可中断等待状态的任务数量。</li>
<li><strong>任务状态</strong>：<ul>
<li><strong>可运行状态</strong>：指的是正在等待CPU资源的任务。</li>
<li><strong>不可中断等待状态</strong>：指的是因I/O操作或锁等待而无法继续执行的任务。</li>
</ul>
</li>
</ul>
<h3 id="负载趋势分析"><a href="#负载趋势分析" class="headerlink" title="负载趋势分析"></a><strong>负载趋势分析</strong></h3><p>通过比较这三个时间段的平均负载值，可以分析系统负载的变化趋势。例如，在上述例子中，1分钟平均负载值（20.29）高于15分钟平均负载值（18.50），这表明系统的负载在最近1分钟内有所上升。</p>
<p><strong>判断系统负载是否饱和</strong></p>
<p>为了评估负载是否过高，可以将平均负载值与CPU核心数进行比较。假设您的系统有16个CPU核心，您可以做如下计算：</p>
<ul>
<li><strong>负载比</strong> = 1分钟平均负载 / CPU核心数</li>
<li><strong>判断</strong>：如果负载比超过1.0，说明系统中的CPU资源可能处于饱和状态。</li>
</ul>
<p>在本例中：</p>
<pre class="line-numbers language-bash"><code class="language-bash">负载比 <span class="token operator">=</span> 20.29 / 16 ≈ 1.27
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这意味着在过去的一分钟内，系统中可用的CPU资源已经不足，任务的排列可能导致响应时间变慢。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><p>通过 <code>uptime</code> 命令监控CPU负载，可以帮助您快速评估系统的性能状态。尽管负载平均值提供了一些关于系统负载需求的见解，但请记住，这些值通常仅用于负载趋势分析，而不能直接作为CPU利用率的衡量标准。为了获得更全面的性能分析，建议结合其他工具（如 <code>mpstat</code>、<code>top</code> 等）进行综合评估。</p>
<h2 id="6-3-mpstat辨认CPU瓶颈"><a href="#6-3-mpstat辨认CPU瓶颈" class="headerlink" title="6.3 mpstat辨认CPU瓶颈"></a>6.3 mpstat辨认CPU瓶颈</h2><p>利用 <code>mpstat</code> 工具，我们可以深入了解系统中每个CPU的使用情况，从而帮助我们识别潜在的性能瓶颈和负载不均衡的问题。以下是如何使用 <code>mpstat</code> 来监控和分析CPU使用率的详细步骤。</p>
<h3 id="环境准备-1"><a href="#环境准备-1" class="headerlink" title="环境准备"></a><strong>环境准备</strong></h3><p>本教程基于 <strong>BCLinux21.10</strong> 系统，但其他 Unix/Linux 发行版的命令输出可能略有差异。尽管如此，核心原理和指标解读方式基本一致。</p>
<hr>
<h3 id="CPU监控"><a href="#CPU监控" class="headerlink" title="CPU监控"></a><strong>CPU监控</strong></h3><h4 id="使用-mpstat-监控-CPU-使用率"><a href="#使用-mpstat-监控-CPU-使用率" class="headerlink" title="使用 mpstat 监控 CPU 使用率"></a><strong>使用 mpstat 监控 CPU 使用率</strong></h4><p><strong>操作步骤：</strong></p>
<ol>
<li><p><strong>安装 sysstat 包（如未安装）</strong></p>
<p>在终端中执行以下命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">bashyum <span class="token function">install</span> sysstat -y
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><strong>执行监控命令：</strong></p>
<p>使用 <code>mpstat</code> 命令来监控CPU的使用情况：</p>
<pre class="line-numbers language-bash"><code class="language-bash">bashmpstat -P ALL 1 5
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这条命令将每秒输出一次CPU的使用情况，连续输出5次。</p>
</li>
</ol>
<h3 id="示例输出解析"><a href="#示例输出解析" class="headerlink" title="示例输出解析"></a><strong>示例输出解析</strong></h3><p>运行命令后，您将看到类似以下的输出：</p>
<pre class="line-numbers language-bash"><code class="language-bash">plaintextLinux 4.19.90-2107.6.0.0100.oe1.bclinux.x86_64 <span class="token punctuation">(</span>panweidb91<span class="token punctuation">)</span>     01/28/2026      _x86_64_        <span class="token punctuation">(</span>4 CPU<span class="token punctuation">)</span>

02:05:33 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
02:05:34 PM  all    0.00    0.00    0.00    0.00    0.25    0.00    0.00    0.00    0.00   99.75
02:05:34 PM    0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
02:05:34 PM    1    0.00    0.00    0.00    0.00    0.97    0.00    0.00    0.00    0.00   99.03
02:05:34 PM    2    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
02:05:34 PM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>输出指标解读：</strong></p>
<ul>
<li><strong>%usr</strong>：表示用户空间进程占用CPU的比例。高值可能意味着应用程序负载较重。</li>
<li><strong>%sys</strong>：表示内核空间占用CPU的比例。高值通常表明系统调用频繁，或者驱动程序存在问题。</li>
<li><strong>%iowait</strong>：表示CPU等待I/O操作完成的时间比例。若该值持续较高，可能意味着存储设备的I/O性能不足。</li>
<li><strong>%idle</strong>：表示CPU空闲的时间比例。若该值低于20%，则可能表示CPU资源紧张，需要考虑优化进程或增加硬件资源。</li>
</ul>
<h3 id="常见性能问题判断"><a href="#常见性能问题判断" class="headerlink" title="常见性能问题判断"></a><strong>常见性能问题判断</strong></h3><p>通过分析这些指标，我们可以判断系统的性能状态，例如：</p>
<ul>
<li><strong>高 %iowait</strong>：如果 <code>%iowait</code> 持续处于高位，表明可能存在存储I/O瓶颈，需检查磁盘性能。</li>
<li><strong>低 %idle</strong>：当 <code>%idle</code> 长期低于20%，说明CPU资源紧张，可能需要优化现有进程，或考虑扩容。</li>
</ul>
<h3 id="负载均衡问题识别"><a href="#负载均衡问题识别" class="headerlink" title="负载均衡问题识别"></a><strong>负载均衡问题识别</strong></h3><p><code>mpstat</code> 工具每秒钟输出每个CPU的使用数据，可以帮助识别负载不均衡的问题。例如，如果某些CPU的使用率很高，而其他CPU的使用率却很低，可能暗示着以下几种情况：</p>
<ul>
<li><strong>应用程序配置不合理</strong>：如应用的线程池、工作进程数配置过小，无法充分调度和利用服务器的所有 CPU 核心，导致业务请求集中在少数核心上处理；</li>
<li><strong>资源绑定限制</strong>：人为或软件层面将特定进程、容器、服务绑定到部分 CPU 核心上运行，限制了 CPU 资源的调度范围，造成绑定核心负载过高，其余核心闲置；</li>
<li><strong>软件层面缺陷</strong>：应用程序本身存在代码 bug、逻辑缺陷，或依赖的中间件、底层库存在调度问题，导致业务处理逻辑无法均匀分配到多个 CPU 核心，引发负载倾斜；</li>
<li><strong>系统调度策略适配问题</strong>：极少数情况下，系统内核的 CPU 调度策略与业务场景不匹配，也会导致核心间负载分配不均。</li>
</ul>
<p>若服务器存在上述 CPU 负载均衡问题，即便整体 CPU 使用率未达到阈值，也会因部分核心被占满，导致业务请求处理缓慢、响应延迟增加，最终表现为系统性能瓶颈，因此通过<code>mpstat</code>识别负载均衡问题，是定位 CPU 瓶颈的重要环节。</p>
<h2 id="6-4-iostat监控磁盘I-x2F-O"><a href="#6-4-iostat监控磁盘I-x2F-O" class="headerlink" title="6.4 iostat监控磁盘I/O"></a>6.4 iostat监控磁盘I/O</h2><p><code>iostat</code> 是 Unix/Linux 系统中一款强大的磁盘 I/O 性能监控工具，通过它可实时获取各磁盘的 I/O 操作统计信息，包括 IOPS（每秒输入输出操作数）、吞吐量、I/O 请求时长及磁盘使用率等关键指标，助力快速定位磁盘性能瓶颈。以下是详细的使用教程，适用于各类 Unix/Linux 系统用户。</p>
<h3 id="环境准备-2"><a href="#环境准备-2" class="headerlink" title="环境准备"></a>环境准备</h3><p>本教程适配所有 Unix/Linux 发行版（如 CentOS、Ubuntu、Debian 等），只需满足两个条件：</p>
<ul>
<li>拥有系统终端访问权限（可通过 SSH 远程连接服务器或直接操作本地工作站）；</li>
<li>系统已预装 <code>iostat</code>（默认集成在 sysstat 工具包中，若未安装，可通过 <code>yum install sysstat</code> 或 <code>apt install sysstat</code> 命令快速安装）。</li>
</ul>
<h3 id="iostat-核心使用方法"><a href="#iostat-核心使用方法" class="headerlink" title="iostat 核心使用方法"></a>iostat 核心使用方法</h3><p><strong>基本命令（常用推荐）</strong></p>
<p>监控磁盘 I/O 最常用的命令的是带详细参数的实时输出模式，步骤如下：</p>
<ol>
<li>打开终端：本地操作直接打开终端窗口，远程服务器通过 SSH 工具（如 Xshell、Putty）连接后进入终端；</li>
<li>执行核心命令：输入以下命令，启动实时监控并输出详细信息：        <code>iostat -dxz 1</code></li>
</ol>
<p>命令参数详细解读（重点必看）：</p>
<ul>
<li>-d：仅显示磁盘相关的 I/O 统计信息，屏蔽 CPU 相关统计（聚焦磁盘，避免信息干扰）；</li>
<li>-x：显示扩展的详细统计列，包含请求时长、队列长度等关键性能指标（默认仅显示基础指标）；</li>
<li>-z：忽略所有指标为 0 的磁盘设备，仅显示有 I/O 活动的设备（精简输出，提升可读性）；</li>
<li>1：指定统计信息的输出间隔，单位为秒（此处表示每秒刷新一次，可根据需求修改，如 5 表示每 5 秒刷新）。</li>
</ul>
<p>补充说明：若需停止监控，按下键盘 <code>Ctrl + C</code> 即可终止命令运行。</p>
<p><strong>输出结果解读</strong></p>
<p>执行上述命令后，终端会持续输出类似以下的统计结果（以两块磁盘 xvda、xvdb 为例）：</p>
<pre class="line-numbers language-bash"><code class="language-bash">Device          r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz  w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz  d/s     dkB/s   drqm/s  %drqm d_await dareq-sz  f/s   f_await  aqu-sz  %util
xvda           150.00   12000.00   5.00    3.33   15.00   80.00   200.00  15000.00  10.00   5.00   20.00  75.00   0.50   20.00   2.00    1.00   25.00   1.50    0.20   100.00   15.00   85.00
xvdb           90.00    8000.00    2.00    2.22   30.00   90.00   50.00   4000.00   3.00    6.00   10.00  80.00   1.00   15.00   0.50    0.50   12.00   0.80    0.10   90.00    8.00   70.00
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>关键列含义</strong></p>
<p>输出列较多，以下是日常性能监控中最常用、最关键的列解读，其余列可根据实际需求参考：</p>
<ul>
<li><strong>Device</strong>：磁盘设备名称（如 xvda、xvdb，对应系统中的物理磁盘或虚拟磁盘）；</li>
<li><strong>r/s</strong>：每秒完成的读请求数（读 IOPS，反映磁盘读操作的频繁程度）；</li>
<li><strong>rkB/s</strong>：每秒从磁盘读取的数据量（读吞吐量，单位：千字节，直观反映读速度）；</li>
<li><strong>w/s</strong>：每秒完成的写请求数（写 IOPS，反映磁盘写操作的频繁程度）；</li>
<li><strong>wkB/s</strong>：每秒向磁盘写入的数据量（写吞吐量，单位：千字节，直观反映写速度）；</li>
<li><strong>r_await</strong>：平均读请求等待时长（单位：毫秒，包含队列等待时间+磁盘处理时间，数值越小越好）；</li>
<li><strong>w_await</strong>：平均写请求等待时长（单位：毫秒，解读同 r_await）；</li>
<li><strong>aqu-sz</strong>：I/O 请求等待队列的平均长度（队列越长，说明磁盘处理能力不足，容易出现阻塞）；</li>
<li><strong>%util</strong>：磁盘忙于处理 I/O 请求的时间百分比（核心指标，反映磁盘负载情况）。</li>
</ul>
<p>补充：d/、f/ 开头的列（如 d/s、f/s）对应设备级、文件系统级的额外统计，日常监控中若无需精细化分析，可暂时忽略。</p>
<p><strong>性能分析技巧</strong></p>
<p>通过解读输出指标，可快速判断磁盘 I/O 性能状态，定位瓶颈，以下是最实用的分析方法：</p>
<ol>
<li><strong>判断磁盘负载是否过高</strong>：核心看 %util 指标。        <ol>
<li>若 %util 长期在 80%~100% 之间，说明磁盘处于高负载状态，可能导致 I/O 阻塞；</li>
<li>若 %util 接近 100%，且 r_await、w_await 数值较大（如超过 20ms），则可确定磁盘 I/O 是系统性能瓶颈。</li>
</ol>
</li>
<li><strong>区分瓶颈类型（读/写瓶颈）</strong>：结合 r/s、w/s、rkB/s、wkB/s 判断。        <ol>
<li>若 r/s、rkB/s 数值较大，且 r_await 偏高，说明存在读瓶颈（如频繁读取大文件、数据库全表扫描）；</li>
<li>若 w/s、wkB/s 数值较大，且 w_await 偏高，说明存在写瓶颈（如频繁写入大量小文件、日志刷盘过于频繁）。</li>
</ol>
</li>
<li><strong>排查队列阻塞问题</strong>：看 aqu-sz 指标。若 aqu-sz 长期大于 2，说明 I/O 请求队列过长，磁盘处理速度跟不上请求产生速度，需优化磁盘或业务逻辑。</li>
<li><strong>定位异常磁盘</strong>：对比多块磁盘的指标，若某一块磁盘的 %util、await 远高于其他磁盘，说明该磁盘存在异常（如磁盘损坏、分区不合理）。</li>
</ol>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><code>iostat</code> 命令的核心价值的是“简单、高效、精准”，无需复杂配置，通过简单参数即可实时监控磁盘 I/O 状态。日常使用中，记住以下核心要点即可满足大部分监控需求：</p>
<ul>
<li>常用命令：<code>iostat -dxz 1</code>（实时、详细、精简输出）；</li>
<li>核心指标：%util（负载）、r_await/w_await（请求时长）、aqu-sz（队列长度）；</li>
<li>核心用途：快速定位磁盘 I/O 瓶颈，为系统优化、容量规划、资源调整提供数据支撑。</li>
</ul>
<h2 id="6-5-ipcs确认共享内存"><a href="#6-5-ipcs确认共享内存" class="headerlink" title="6.5 ipcs确认共享内存"></a>6.5 ipcs确认共享内存</h2><p>下面是关于如何使用 <code>ipcs</code> 命令查看磐维数据库（Panweidb）使用的共享内存的简单教程。</p>
<h3 id="6-5-1-使用-ipcs-命令"><a href="#6-5-1-使用-ipcs-命令" class="headerlink" title="6.5.1 使用 ipcs 命令"></a>6.5.1 使用 <code>ipcs</code> 命令</h3><p><code>ipcs</code> 命令用于显示系统中的消息队列、共享内存段和信号量的信息。您可以使用不同的选项来定制输出。</p>
<h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a><strong>基本命令</strong></h4><pre class="line-numbers language-bash"><code class="language-bash">ipcs
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此命令将显示所有 IPC 资源的信息，包括消息队列、共享内存和信号量。</p>
<h3 id="6-5-2-查看共享内存段"><a href="#6-5-2-查看共享内存段" class="headerlink" title="6.5.2 查看共享内存段"></a><strong>6.5.2 查看共享内存段</strong></h3><p>要查看具体的共享内存段，您可以使用以下命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">ipcs -m
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该命令将输出当前系统的所有共享内存段信息，包括每个段的键（key）、标识符（shmid）、拥有者（owner）、权限（perms）、字节数（bytes）、附加次数（nattch）和状态（status）。</p>
<h4 id="示例输出分析"><a href="#示例输出分析" class="headerlink" title="示例输出分析"></a><strong>示例输出分析</strong></h4><p>输出示例：</p>
<pre class="line-numbers language-bash"><code class="language-bash">plaintext------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status
0x010e14a1 0          omm        600        815420360  1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>key</strong>：共享内存段的唯一标识符。</li>
<li><strong>shmid</strong>：共享内存段的 ID。</li>
<li><strong>owner</strong>：创建该共享内存段的用户。</li>
<li><strong>perms</strong>：访问权限（600 表示可读可写）。</li>
<li><strong>bytes</strong>：共享内存段的大小（815420360 字节）。</li>
<li><strong>nattch</strong>：当前附加到该共享内存段的进程数量（1 表示一个进程正在使用它）。</li>
<li><strong>status</strong>：共享内存的状态。</li>
</ul>
<h3 id="6-5-3-查看基本-IPC-资源信息"><a href="#6-5-3-查看基本-IPC-资源信息" class="headerlink" title="6.5.3 查看基本 IPC 资源信息**"></a>6.5.3 查看基本 IPC 资源信息**</h3><p>如果您只想获取简化的 IPC 资源统计信息，可以使用 <code>-b</code> 选项：</p>
<pre class="line-numbers language-bash"><code class="language-bash">ipcs -b
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此命令将输出系统中所有 IPC 资源的基础信息，不会显示详细内容，但能快速提供资源使用情况。</p>
<h4 id="示例输出"><a href="#示例输出" class="headerlink" title="示例输出"></a><strong>示例输出</strong></h4><p>运行 <code>ipcs -b</code> 后，您可能会看到如下输出：</p>
<pre class="line-numbers language-bash"><code class="language-bash">plaintext------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status

------ Semaphore Arrays --------
key        semid      owner      perms      nsems
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-5-4-实时监控共享内存"><a href="#6-5-4-实时监控共享内存" class="headerlink" title="6.5.4 实时监控共享内存"></a>6.5.4 实时监控共享内存</h3><p>您可以结合使用 <code>watch</code> 命令，实时监控共享内存的使用情况：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">watch</span> -n 1 ipcs -m
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这将每秒更新一次共享内存段的信息，帮助您及时了解内存使用情况。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">JINLID</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jinlid.github.io/2026/6.jian-kong-ming-ling/">https://jinlid.github.io/2026/6.jian-kong-ming-ling/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">JINLID</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7/">
                                    <span class="chip bg-color">性能调优工具</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2026/4.diao-you-yi-zhu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="第四章--调优艺术">
                        
                        <span class="card-title">第四章--调优艺术</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2026-01-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/linux/" class="post-category">
                                    linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BC%93%E5%AD%98%EF%BC%8C%E7%B4%A2%E5%BC%95-%E5%88%86%E5%8C%BA/">
                        <span class="chip bg-color">缓存，索引,分区</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                本篇&nbsp;<i class="far fa-dot-circle"></i>
            </div>
            <div class="card">
                <a href="/2026/6.jian-kong-ming-ling/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="第六章--监控命令">
                        
                        <span class="card-title">第六章--监控命令</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            [TOC]
本章介绍Linux环境下系统资源监控的核心命令，重点讲解sar、uptime、mpstat、iostat、ipcs五大高频命令的应用。这些命令分别针对CPU、磁盘I/O、共享内存等关键系统资源，实现快速巡检、性能统计与瓶颈定位，
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2026-01-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/linux/" class="post-category">
                                    linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7/">
                        <span class="chip bg-color">性能调优工具</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2026</span>
            
            <a href="/about" target="_blank">JINLID</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/jinlid" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
